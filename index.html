<!DOCTYPE html>
<html>
<head>
    <title>Cooler Information</title>
    <style type="text/css">
        body {
            background-image: url('images/coldwall.jpg');
            background-size: cover;
            font-family: 'Roboto', sans-serif;
        }
        canvas {
            width: 100%;
            height: 35rem;
        }
        
        .cooler-info {
            display: flex;
            justify-content: space-between;
            margin: 2rem;
        }
        
        .cooler-info div {
            flex-basis: 25%;
            text-align: center;
        }
        
        .cooler-info h3 {
            margin-top: 0;
        }
        
        .cooler-info h4 {
            margin-bottom: 0;
        }
        #chartContainer {
            width: 100%;
            max-height: 30rem; /* Adjust the max-height as desired */
            overflow: auto;
        }
    </style>
     <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <h1 style="text-align: center;">
        Cooler Temperatures
    </h1>
    
    <div class="cooler-info">
        <div>
            <h3>Cooler One</h3>
            <h4>Current Temperature: <span id="cooler1Temp"></span></h4>
        </div>
        <div>
            <h3>Cooler Two</h3>
            <h4>Current Temperature: <span id="cooler2Temp"></span></h4>
        </div>
        <div>
            <h3>Cooler 3</h3>
            <h4>Current Temperature: <span id="cooler3Temp"></span></h4>
        </div>
        <div>
            <h3>Freezer</h3>
            <h4>Current Temperature: <span id="freezerTemp"></span></h4>
        </div>
    </div>

    
    <canvas id="chartContainer"></canvas>
    <script src = "CoolerSensor.js"> </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.js"></script>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-base.min.js"></script>
    <script>
        var data = [];
var sensorMap = new Map();
var cooler1Temps = [];
var cooler2Temps = [];
var cooler3Temps = [];
var freezerTemps = [];

fetch('http://localhost:3000/temperature')
    .then((response) => response.json())
    .then((json) => {
        console.log(json); // Log the received data to the console

        // Merge the new data with the previous data
        data = data.concat(json);

        // Update the sensor map with the merged data
        Object.values(json).forEach(element => {
            var temp = Object.values(element);
            sensorMap.set(temp[0], new CoolerSensor(temp[1], temp[2], temp[3], temp[4], temp[5]));
        });

        var cooler1Sensor = sensorMap.get("64a5957082a0dadb53cdebb6");
        var cooler2Sensor = sensorMap.get("64a5c6d33120c2441148a755");
        var cooler3Sensor = sensorMap.get("64a5c70a3120c2441148a757");
        var freezerSensor = sensorMap.get("64a5c7333120c2441148a759");

        // Update the temperature arrays with new values
        cooler1Temps = cooler1Temps.concat(cooler1Sensor ? [cooler1Sensor.temp] : []);
        cooler2Temps = cooler2Temps.concat(cooler2Sensor ? [cooler2Sensor.temp] : []);
        cooler3Temps = cooler3Temps.concat(cooler3Sensor ? [cooler3Sensor.temp] : []);
        freezerTemps = freezerTemps.concat(freezerSensor ? [freezerSensor.temp] : []);

        console.log(cooler1Temps); // Log the Cooler 1 temperature values to the console
        console.log(cooler2Temps); // Log the Cooler 2 temperature values to the console
        console.log(cooler3Temps); // Log the Cooler 3 temperature values to the console
        console.log(freezerTemps); // Log the Freezer temperature values to the console

        // Update the HTML elements with temperature values
        document.getElementById("cooler1Temp").innerText = cooler1Temps.join(", ") || "N/A";
        document.getElementById("cooler2Temp").innerText = cooler2Temps.join(", ") || "N/A";
        document.getElementById("cooler3Temp").innerText = cooler3Temps.join(", ") || "N/A";
        document.getElementById("freezerTemp").innerText = freezerTemps.join(", ") || "N/A";

        // Create a line chart using Chart.js
        var ctx = document.getElementById('chartContainer').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(cooler => cooler.time), // Assuming time represents the x-axis values
                datasets: [
                    {
                        label: 'Cooler 1',
                        data: cooler1Temps,
                        backgroundColor: 'rgba(75, 192, 192 )',
                        borderColor: 'rgba(75, 192, 192)',
                        borderWidth: 1
                    },
                    {
                        label: 'Cooler 2',
                        data: cooler2Temps,
                        backgroundColor: 'rgba(192, 75, 75)',
                        borderColor: 'rgba(192, 75, 75)',
                        borderWidth: 1
                    },
                    {
                        label: 'Cooler 3',
                        data: cooler3Temps,
                        backgroundColor: 'rgba(192, 192, 75)',
                        borderColor: 'rgba(192, 192, 75)',
                        borderWidth: 1
                    },
                    {
                        label: 'Freezer',
                        data: freezerTemps,
                        backgroundColor: 'rgba(75, 75, 192)',
                        borderColor: 'rgba(75, 75, 192)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        display: true,
                        title: {
                            display: true,
                            text: 'Time'
                        }
                    },
                    y: {
                        display: true,
                        title: {
                            display: true,
                            text: 'Temperature (Â°C)'
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Cooler Temperatures',
                        font: {
                            size: 20
                        }
                    }
                }
            }
        });
    })
    .catch((error) => {
        console.error('Error fetching data:', error);
    });


    </script>
</body>
</html>